<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š Poetry Analyzer - AI ê¸°ë°˜ ì‹œ ë¶„ì„ ë„êµ¬</title>
    <meta name="description" content="AIë¥¼ í™œìš©í•œ ì˜ì–´ ì‹œ ë¶„ì„ ë„êµ¬. ìˆ˜ì‚¬ë²•, ìš´ìœ¨, ì£¼ì œ ë“±ì„ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ êµìœ¡ ìë£Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.">
    <meta name="keywords" content="poetry analysis, AI, literature, education, ì‹œ ë¶„ì„, ë¬¸í•™ ë¶„ì„">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Poetry Analyzer - AI ê¸°ë°˜ ì‹œ ë¶„ì„ ë„êµ¬">
    <meta property="og:description" content="ì˜ì–´ ì‹œë¥¼ AIë¡œ ë¶„ì„í•˜ì—¬ ìˆ˜ì‚¬ë²•, ìš´ìœ¨, ì£¼ì œ ë“±ì„ ìë™ìœ¼ë¡œ ì°¾ì•„ì£¼ëŠ” êµìœ¡ìš© ë„êµ¬">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourusername.github.io/poetry-analyzer">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.7;
            color: #1a1a1a;
            background: #ffffff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 60px;
            padding: 60px 0;
            border-bottom: 3px solid #1a1a1a;
        }
        
        .header h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            font-weight: 300;
            letter-spacing: -2px;
            animation: fadeInDown 1s ease-out;
        }
        
        .header p {
            font-size: 1.2em;
            color: #666;
            font-weight: 300;
            animation: fadeInUp 1s ease-out 0.3s both;
        }
        
        .main-content {
            background: #ffffff;
            border: 3px solid #1a1a1a;
            padding: 50px;
            margin-bottom: 40px;
            animation: fadeIn 1s ease-out 0.6s both;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .feature-card {
            background: #ffffff;
            color: #1a1a1a;
            padding: 30px;
            border: 2px solid #1a1a1a;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .feature-card:hover {
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 20px;
            display: block;
        }
        
        .feature-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }
        
        .feature-desc {
            font-size: 0.9em;
            line-height: 1.5;
            opacity: 0.8;
        }
        
        .input-section {
            margin-bottom: 50px;
        }
        
        .input-section h2 {
            color: #1a1a1a;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 300;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 12px;
            font-size: 1em;
            letter-spacing: 0.3px;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 18px;
            border: 2px solid #1a1a1a;
            background: #ffffff;
            color: #1a1a1a;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1a1a1a;
            background: #f9f9f9;
        }
        
        #poemInput {
            min-height: 300px;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            resize: vertical;
        }
        
        .char-count {
            text-align: right;
            color: #666;
            font-size: 13px;
            margin-top: 10px;
            font-style: italic;
        }
        
        .sample-section {
            margin-top: 30px;
            padding: 30px;
            background: #ffffff;
            border: 2px solid #e0e0e0;
        }
        
        .sample-section h3 {
            color: #1a1a1a;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .sample-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .sample-btn {
            padding: 12px 20px;
            background: #ffffff;
            border: 2px solid #1a1a1a;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            color: #1a1a1a;
            font-weight: 400;
            letter-spacing: 0.3px;
        }
        
        .sample-btn:hover {
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .api-key-section {
            background: #ffffff;
            border: 2px solid #1a1a1a;
            padding: 30px;
            margin-bottom: 40px;
        }
        
        .api-key-section h3 {
            color: #1a1a1a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            font-size: 1.2em;
        }
        
        .api-key-section p {
            color: #1a1a1a;
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .api-key-section a {
            color: #1a1a1a;
            text-decoration: underline;
            font-weight: 600;
        }
        
        .api-key-section a:hover {
            text-decoration: none;
        }
        
        .btn {
            padding: 18px 35px;
            border: 2px solid #1a1a1a;
            background: #ffffff;
            color: #1a1a1a;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            text-align: center;
            letter-spacing: 0.5px;
            font-family: 'Georgia', serif;
        }
        
        .btn-primary {
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .btn-primary:hover {
            background: #ffffff;
            color: #1a1a1a;
        }
        
        .btn-secondary {
            background: #ffffff;
            color: #1a1a1a;
        }
        
        .btn-secondary:hover {
            background: #1a1a1a;
            color: #ffffff;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .button-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 50px 0;
            flex-wrap: wrap;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 60px;
            color: #1a1a1a;
            border: 2px solid #1a1a1a;
            background: #ffffff;
            margin: 40px 0;
        }
        
        .loading .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #e0e0e0;
            border-top: 3px solid #1a1a1a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }
        
        .loading h3 {
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 400;
        }
        
        .loading p {
            font-size: 1em;
            opacity: 0.7;
            line-height: 1.6;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            overflow: hidden;
            margin: 30px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #1a1a1a;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .error-message {
            background: #ffffff;
            border: 2px solid #1a1a1a;
            color: #1a1a1a;
            padding: 25px;
            margin: 30px 0;
            display: none;
        }
        
        .error-message h4 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }
        
        .results {
            display: none;
            margin-top: 50px;
        }
        
        .results-header {
            background: #1a1a1a;
            color: #ffffff;
            padding: 40px;
            text-align: center;
        }
        
        .results-header h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 300;
            letter-spacing: -1px;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stat-number {
            font-size: 1.8em;
            font-weight: 300;
            display: block;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.85em;
            opacity: 0.8;
            letter-spacing: 0.5px;
        }
        
        .results-content {
            background: #ffffff;
            border: 2px solid #1a1a1a;
            border-top: none;
            padding: 50px;
        }
        
        .download-section {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .download-section h3 {
            color: #1a1a1a;
            margin-bottom: 25px;
            font-size: 1.3em;
            font-weight: 400;
            letter-spacing: 0.5px;
        }
        
        .preview-section {
            margin-top: 40px;
            padding: 35px;
            background: #ffffff;
            border: 2px solid #e0e0e0;
        }
        
        .preview-title {
            font-size: 1.2em;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: 0.3px;
        }
        
        .preview-content {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            padding: 25px;
            background: #fafafa;
            font-size: 0.9em;
            line-height: 1.7;
            color: #1a1a1a;
        }
        
        .footer {
            text-align: center;
            color: #1a1a1a;
            margin-top: 80px;
            padding: 40px 0;
            border-top: 1px solid #e0e0e0;
        }
        
        .footer p {
            margin-bottom: 12px;
            opacity: 0.7;
            font-size: 0.9em;
        }
        
        .footer a {
            color: #1a1a1a;
            text-decoration: underline;
        }
        
        .footer a:hover {
            text-decoration: none;
        }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .header p {
                font-size: 1.1em;
            }
            
            .main-content {
                padding: 25px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .sample-buttons {
                flex-direction: column;
            }
            
            .sample-btn {
                text-align: center;
            }
        }
        
        /* ì¶”ê°€ ìŠ¤íƒ€ì¼ë§ */
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f0f0f0 !important;
            color: #999 !important;
            border-color: #ddd !important;
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #999;
            font-style: italic;
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .preview-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .preview-content::-webkit-scrollbar-track {
            background: #f0f0f0;
        }
        
        .preview-content::-webkit-scrollbar-thumb {
            background: #1a1a1a;
        }
        
        .preview-content::-webkit-scrollbar-thumb:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Poetry Analyzer</h1>
            <p>AI ê¸°ë°˜ ì˜ì–´ ì‹œ ë¶„ì„ ë„êµ¬ - ìˆ˜ì‚¬ë²•, ìš´ìœ¨, ì£¼ì œë¥¼ ìë™ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤</p>
        </div>
        
        <div class="main-content">
            <!-- ì£¼ìš” ê¸°ëŠ¥ ì†Œê°œ -->
            <div class="feature-grid">
                <div class="feature-card">
                    <span class="feature-icon">ğŸ­</span>
                    <div class="feature-title">ìˆ˜ì‚¬ë²• ë¶„ì„</div>
                    <div class="feature-desc">ì€ìœ , ì§ìœ , ì˜ì¸ë²• ë“± ë‹¤ì–‘í•œ ìˆ˜ì‚¬ë²•ì„ ìë™ìœ¼ë¡œ ì‹ë³„</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸµ</span>
                    <div class="feature-title">ìš´ìœ¨ ë¶„ì„</div>
                    <div class="feature-desc">ë‘ìš´ë²•, ê°ìš´ë²•, ë¦¬ë“¬ íŒ¨í„´ì„ ì •ë°€í•˜ê²Œ ë¶„ì„</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸ”®</span>
                    <div class="feature-title">ì£¼ì œ ë¶„ì„</div>
                    <div class="feature-desc">ì‹œì˜ ì£¼ì œ, ìƒì§•, ëª¨í‹°í”„ë¥¼ ê¹Šì´ ìˆê²Œ í•´ì„</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ğŸ“„</span>
                    <div class="feature-title">HTML ë³´ê³ ì„œ</div>
                    <div class="feature-desc">ì•„ë¦„ë‹¤ìš´ HTML í˜•íƒœì˜ ë¶„ì„ ë³´ê³ ì„œ ìë™ ìƒì„±</div>
                </div>
            </div>
            
            <!-- API í‚¤ ì„¤ì • ì•ˆë‚´ -->
            <div class="api-key-section">
                <h3>ğŸ”‘ API í‚¤ ì„¤ì • í•„ìš”</h3>
                <p>ì´ ë„êµ¬ëŠ” Google Gemini APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì•„ë˜ ë‹¨ê³„ë¥¼ ë”°ë¼ API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”:</p>
                <ol style="margin-left: 20px; margin-bottom: 15px;">
                    <li><a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>ì—ì„œ ë¬´ë£Œ API í‚¤ ë°œê¸‰</li>
                    <li>ì•„ë˜ ì…ë ¥ë€ì— API í‚¤ë¥¼ ì…ë ¥</li>
                    <li>API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
                </ol>
            </div>
            
            <!-- API í‚¤ ì…ë ¥ -->
            <div class="form-group">
                <label for="apiKey">ğŸ”‘ Google Gemini API í‚¤</label>
                <input type="password" id="apiKey" placeholder="ì—¬ê¸°ì— API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: AIzaSy...)">
                <div class="char-count">API í‚¤ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë˜ë©° ì•ˆì „í•©ë‹ˆë‹¤</div>
            </div>
            
            <!-- ì‹œ ì œëª© ì…ë ¥ -->
            <div class="input-section">
                <h2>ğŸ“ ì‹œ ì •ë³´ ì…ë ¥</h2>
                
                <div class="form-group">
                    <label for="poemTitle">ì‹œ ì œëª© (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="poemTitle" placeholder="ì˜ˆ: The Road Not Taken by Robert Frost">
                </div>
                
                <!-- ì‹œ ì›ë¬¸ ì…ë ¥ -->
                <div class="form-group">
                    <label for="poemInput">ì‹œ ì›ë¬¸</label>
                    <textarea id="poemInput" placeholder="ì˜ì–´ ì‹œì˜ ì›ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...

ì˜ˆì‹œ:
Two roads diverged in a yellow wood,
And sorry I could not travel both
And be one traveler, long I stood
And looked down one as far as I could
To where it bent in the undergrowth;"></textarea>
                    <div class="char-count" id="charCount">0 ê¸€ì</div>
                </div>
                
                <!-- ìƒ˜í”Œ ì‹œ -->
                <div class="sample-section">
                    <h3>ğŸ“– ìœ ëª…í•œ ì‹œ ìƒ˜í”Œ</h3>
                    <div class="sample-buttons">
                        <button class="sample-btn" onclick="loadSample('frost')">Robert Frost - The Road Not Taken</button>
                        <button class="sample-btn" onclick="loadSample('shakespeare')">Shakespeare - Sonnet 18</button>
                        <button class="sample-btn" onclick="loadSample('poe')">Edgar Allan Poe - The Raven</button>
                        <button class="sample-btn" onclick="loadSample('dickinson')">Emily Dickinson - Hope</button>
                        <button class="sample-btn" onclick="loadSample('blake')">William Blake - The Tyger</button>
                    </div>
                </div>
            </div>
            
            <!-- ë¶„ì„ ë²„íŠ¼ -->
            <div class="button-group">
                <button class="btn btn-primary" id="analyzeBtn" onclick="analyzePoem()">
                    ğŸ” ì‹œ ë¶„ì„í•˜ê¸°
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    ğŸ—‘ï¸ ì´ˆê¸°í™”
                </button>
            </div>
            
            <!-- ë¡œë”© ìƒíƒœ -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <h3>AIê°€ ì‹œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
                <p>ìˆ˜ì‚¬ë²•, ìš´ìœ¨, ì£¼ì œ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">ë¶„ì„ ì¤€ë¹„ ì¤‘...</p>
            </div>
            
            <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
            <div class="error-message" id="errorMessage">
                <h4>âŒ ì˜¤ë¥˜ ë°œìƒ</h4>
                <p id="errorText"></p>
            </div>
            
            <!-- ë¶„ì„ ê²°ê³¼ -->
            <div class="results" id="results">
                <div class="results-header">
                    <h2>ğŸ‰ ë¶„ì„ ì™„ë£Œ!</h2>
                    <p>ì‹œì˜ ë‹¤ì–‘í•œ ë¬¸í•™ì  ìš”ì†Œë“¤ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>
                    <div class="results-stats" id="resultsStats">
                        <!-- í†µê³„ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <div class="results-content">
                    <div class="download-section">
                        <h3>ğŸ“„ ë¶„ì„ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</h3>
                        <button class="btn btn-primary" onclick="downloadReport()">
                            ğŸ’¾ HTML ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                    
                    <!-- ë¶„ì„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="preview-section">
                        <div class="preview-title">
                            <span>ğŸ‘ï¸</span>
                            <span>ë¶„ì„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</span>
                        </div>
                        <div class="preview-content" id="previewContent">
                            <!-- ë¶„ì„ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ¤– Powered by Google Gemini AI & LangExtract</p>
            <p>ğŸ“š êµìœ¡ìš© ì‹œ ë¶„ì„ ë„êµ¬ - ë¬´ë£Œë¡œ ì‚¬ìš©í•˜ì„¸ìš”</p>
            <p>ğŸ’¡ <a href="https://github.com/yourusername/poetry-analyzer" target="_blank">GitHubì—ì„œ ì†ŒìŠ¤ ì½”ë“œ ë³´ê¸°</a></p>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentAnalysisResult = null;
        let analysisInProgress = false;
        
        // ìƒ˜í”Œ ì‹œ ë°ì´í„°
        const samplePoems = {
            frost: {
                title: "The Road Not Taken by Robert Frost",
                text: `Two roads diverged in a yellow wood,
And sorry I could not travel both
And be one traveler, long I stood
And looked down one as far as I could
To where it bent in the undergrowth;

Then took the other, as just as fair,
And having perhaps the better claim,
Because it was grassy and wanted wear;
Though as for that the passing there
Had worn them really about the same,

And both that morning equally lay
In leaves no step had trodden black.
Oh, I kept the first for another day!
Yet knowing how way leads on to way,
I doubted if I should ever be back.

I shall be telling this with a sigh
Somewhere ages and ages hence:
Two roads diverged in a wood, and Iâ€”
I took the one less traveled by,
And that has made all the difference.`
            },
            
            shakespeare: {
                title: "Sonnet 18 by William Shakespeare",
                text: `Shall I compare thee to a summer's day?
Thou art more lovely and more temperate:
Rough winds do shake the darling buds of May,
And summer's lease hath all too short a date:
Sometime too hot the eye of heaven shines,
And often is his gold complexion dimm'd;
And every fair from fair sometime declines,
By chance or nature's changing course, untrimm'd;
But thy eternal summer shall not fade,
Nor lose possession of that fair thou owest;
Nor shall Death brag thou wander'st in his shade,
When in eternal lines to time thou growest:
So long as men can breathe or eyes can see,
So long lives this, and this gives life to thee.`
            },
            
            poe: {
                title: "The Raven by Edgar Allan Poe (excerpt)",
                text: `Once upon a midnight dreary, while I pondered, weak and weary,
Over many a quaint and curious volume of forgotten loreâ€”
While I nodded, nearly napping, suddenly there came a tapping,
As of some one gently rapping, rapping at my chamber door.
"'Tis some visitor," I muttered, "tapping at my chamber doorâ€”
Only this and nothing more."

Ah, distinctly I remember it was in the bleak December;
And each separate dying ember wrought its ghost upon the floor.
Eagerly I wished the morrow;â€”vainly I had sought to borrow
From my books surcease of sorrowâ€”sorrow for the lost Lenoreâ€”
For the rare and radiant maiden whom the angels name Lenoreâ€”
Nameless here for evermore.`
            },
            
            dickinson: {
                title: "Hope is the thing with feathers by Emily Dickinson",
                text: `Hope is the thing with feathers
That perches in the soul,
And sings the tune without the words,
And never stops at all,

And sweetest in the gale is heard;
And sore must be the storm
That could abash the little bird
That kept so many warm.

I've heard it in the chillest land,
And on the strangest sea;
Yet, never, in extremity,
It asked a crumb of me.`
            },
            
            blake: {
                title: "The Tyger by William Blake",
                text: `Tyger Tyger, burning bright,
In the forests of the night;
What immortal hand or eye,
Could frame thy fearful symmetry?

In what distant deeps or skies.
Burnt the fire of thine eyes?
On what wings dare he aspire?
What the hand, dare seize the fire?

And what shoulder, & what art,
Could twist the sinews of thy heart?
And when thy heart began to beat,
What dread hand? & what dread feet?`
            }
        };
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateCharCount();
            loadApiKey();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // í…ìŠ¤íŠ¸ ì…ë ¥ ì‹œ ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('poemInput').addEventListener('input', updateCharCount);
            
            // API í‚¤ ì €ì¥
            document.getElementById('apiKey').addEventListener('change', saveApiKey);
        }
        
        function updateCharCount() {
            const text = document.getElementById('poemInput').value;
            const count = text.length;
            document.getElementById('charCount').textContent = count.toLocaleString() + ' ê¸€ì';
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey) {
                localStorage.setItem('gemini_api_key', apiKey);
            }
        }
        
        function loadApiKey() {
            const savedApiKey = localStorage.getItem('gemini_api_key');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }
        }
        
        function loadSample(type) {
            const sample = samplePoems[type];
            if (sample) {
                document.getElementById('poemTitle').value = sample.title;
                document.getElementById('poemInput').value = sample.text;
                updateCharCount();
            }
        }
        
        function clearAll() {
            document.getElementById('poemTitle').value = '';
            document.getElementById('poemInput').value = '';
            document.getElementById('results').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            currentAnalysisResult = null;
            updateCharCount();
        }
        
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }
        
        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        async function analyzePoem() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const title = document.getElementById('poemTitle').value.trim() || 'ì‹œ ë¶„ì„';
            const text = document.getElementById('poemInput').value.trim();
            
            // ì…ë ¥ ê²€ì¦
            if (!apiKey) {
                showError('Google Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. AI Studioì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!text) {
                showError('ë¶„ì„í•  ì‹œì˜ ì›ë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (analysisInProgress) {
                return;
            }
            
            analysisInProgress = true;
            hideError();
            
            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            // ì§„í–‰ë¥  ì‹œë®¬ë ˆì´ì…˜
            simulateProgress();
            
            try {
                // Gemini API ì§ì ‘ í˜¸ì¶œ
                const result = await callGeminiAPI(apiKey, text, title);
                
                if (result) {
                    currentAnalysisResult = result;
                    displayResults(result);
                } else {
                    showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                analysisInProgress = false;
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        async function callGeminiAPI(apiKey, text, title) {
            const prompt = `Please analyze the following English poem comprehensively:

Title: ${title}

Poem:
${text}

Please analyze from these aspects:
1. Rhetorical Devices: metaphor, simile, personification, hyperbole, etc.
2. Sound Devices: alliteration, rhyme, rhythm, meter, etc.
3. Themes & Symbols: major themes, symbols, motifs, etc.
4. Style & Tone: stylistic features, tone, mood, etc.
5. Structure & Form: poetic form, organization, rhyme scheme, etc.

Please provide specific examples and explanations for each analysis item.
Structure the analysis results in JSON format.

JSON format:
{
  "title": "poem title",
  "analysis": {
    "rhetorical_devices": [
      {
        "type": "device type",
        "text": "relevant passage",
        "explanation": "explanation"
      }
    ],
    "sound_devices": [...],
    "themes_symbols": [...],
    "style_tone": [...],
    "structure_form": [...]
  },
  "summary": "overall analysis summary"
}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.3,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 2048,
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    let errorMessage = `API í˜¸ì¶œ ì‹¤íŒ¨ (${response.status})`;
                    
                    if (response.status === 400) {
                        errorMessage = 'API í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ìš”ì²­ í˜•ì‹ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.';
                    } else if (response.status === 403) {
                        errorMessage = 'API í‚¤ ê¶Œí•œì´ ì—†ê±°ë‚˜ í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.';
                    } else if (response.status === 429) {
                        errorMessage = 'API ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (response.status >= 500) {
                        errorMessage = 'Google ì„œë²„ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const content = data.candidates[0].content.parts[0].text;
                    
                    // JSON ì¶”ì¶œ ì‹œë„
                    try {
                        const jsonMatch = content.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            const jsonStr = jsonMatch[0];
                            return JSON.parse(jsonStr);
                        } else {
                            // JSONì´ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ íŒŒì‹±
                            return parseTextResponse(content, title);
                        }
                    } catch (e) {
                        console.warn('JSON íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ íŒŒì‹±ìœ¼ë¡œ ì „í™˜:', e);
                        return parseTextResponse(content, title);
                    }
                } else if (data.candidates && data.candidates[0] && data.candidates[0].finishReason === 'SAFETY') {
                    throw new Error('ì½˜í…ì¸ ê°€ ì•ˆì „ ì •ì±…ì— ì˜í•´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì‹œë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.');
                } else {
                    throw new Error('API ì‘ë‹µì—ì„œ ìœ íš¨í•œ ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
                throw error;
            }
        }
        
        function parseTextResponse(content, title) {
            // í…ìŠ¤íŠ¸ ì‘ë‹µì„ êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ íŒŒì‹±
            const analysis = {
                rhetorical_devices: [],
                sound_devices: [],
                themes_symbols: [],
                style_tone: [],
                structure_form: []
            };
            
            // ê°œì„ ëœ í…ìŠ¤íŠ¸ íŒŒì‹± ë¡œì§
            const lines = content.split('\n');
            let currentSection = '';
            let currentItem = null;
            
            for (const line of lines) {
                const trimmed = line.trim();
                
                // ì„¹ì…˜ í—¤ë” ê°ì§€
                if (trimmed.match(/rhetorical|ìˆ˜ì‚¬ë²•|figurative/i)) {
                    currentSection = 'rhetorical_devices';
                } else if (trimmed.match(/sound|ìŒì„±|alliteration|rhyme/i)) {
                    currentSection = 'sound_devices';
                } else if (trimmed.match(/theme|ì£¼ì œ|symbol|ìƒì§•/i)) {
                    currentSection = 'themes_symbols';
                } else if (trimmed.match(/style|ë¬¸ì²´|tone|ì–´ì¡°/i)) {
                    currentSection = 'style_tone';
                } else if (trimmed.match(/structure|êµ¬ì¡°|form|í˜•ì‹/i)) {
                    currentSection = 'structure_form';
                }
                
                // ë¶„ì„ í•­ëª© ì¶”ì¶œ
                if (currentSection && trimmed) {
                    // ê¸°ë²• ìœ í˜• ê°ì§€
                    const deviceMatch = trimmed.match(/(metaphor|simile|personification|alliteration|rhyme|symbol|theme)/i);
                    if (deviceMatch) {
                        const deviceType = deviceMatch[1];
                        const textMatch = trimmed.match(/"([^"]+)"/);
                        const quotedText = textMatch ? textMatch[1] : trimmed;
                        
                        analysis[currentSection].push({
                            type: deviceType,
                            text: quotedText,
                            explanation: trimmed
                        });
                    } else if (trimmed.includes('-') || trimmed.includes('â€¢') || trimmed.includes('*')) {
                        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì²˜ë¦¬
                        const cleanText = trimmed.replace(/^[-â€¢*]\s*/, '');
                        if (cleanText.length > 10) {
                            analysis[currentSection].push({
                                type: 'Literary Device',
                                text: cleanText.substring(0, 50) + '...',
                                explanation: cleanText
                            });
                        }
                    }
                }
            }
            
            // ë¹ˆ ì„¹ì…˜ì— ê¸°ë³¸ í•­ëª© ì¶”ê°€
            Object.keys(analysis).forEach(key => {
                if (analysis[key].length === 0) {
                    analysis[key].push({
                        type: 'Analysis',
                        text: 'Various literary elements detected',
                        explanation: 'This poem contains multiple literary devices that contribute to its overall effect.'
                    });
                }
            });
            
            return {
                title: title,
                analysis: analysis,
                summary: content.length > 300 ? content.substring(0, 300) + '...' : content
            };
        }
        
        function simulateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const steps = [
                { progress: 20, text: 'ì‹œ êµ¬ì¡° ë¶„ì„ ì¤‘...' },
                { progress: 40, text: 'ìˆ˜ì‚¬ë²• íƒì§€ ì¤‘...' },
                { progress: 60, text: 'ìš´ìœ¨ íŒ¨í„´ ë¶„ì„ ì¤‘...' },
                { progress: 80, text: 'ì£¼ì œ í•´ì„ ì¤‘...' },
                { progress: 95, text: 'ë³´ê³ ì„œ ìƒì„± ì¤‘...' },
                { progress: 100, text: 'ë¶„ì„ ì™„ë£Œ!' }
            ];
            
            let currentStep = 0;
            
            const updateProgress = () => {
                if (currentStep < steps.length && analysisInProgress) {
                    const step = steps[currentStep];
                    progressFill.style.width = step.progress + '%';
                    progressText.textContent = step.text;
                    currentStep++;
                    
                    setTimeout(updateProgress, 1000 + Math.random() * 2000);
                }
            };
            
            updateProgress();
        }
        
        function displayResults(result) {
            const analysis = result.analysis;
            
            // í†µê³„ ê³„ì‚°
            const totalDevices = Object.values(analysis).reduce((sum, category) => sum + category.length, 0);
            const categoriesWithResults = Object.values(analysis).filter(category => category.length > 0).length;
            
            // í†µê³„ í‘œì‹œ
            document.getElementById('resultsStats').innerHTML = `
                <div class="stat-card">
                    <span class="stat-number">${totalDevices}</span>
                    <span class="stat-label">ë°œê²¬ëœ ê¸°ë²•</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${categoriesWithResults}</span>
                    <span class="stat-label">ë¶„ì„ ì˜ì—­</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${document.getElementById('poemInput').value.split(' ').length}</span>
                    <span class="stat-label">ë‹¨ì–´ ìˆ˜</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">${document.getElementById('poemInput').value.split('\n').length}</span>
                    <span class="stat-label">í–‰ ìˆ˜</span>
                </div>
            `;
            
            // ë¯¸ë¦¬ë³´ê¸° ìƒì„±
            let previewHtml = `<h3>${result.title}</h3><br>`;
            previewHtml += `<p><strong>ì „ì²´ ìš”ì•½:</strong> ${result.summary}</p><br>`;
            
            const categoryNames = {
                rhetorical_devices: 'ğŸ­ ìˆ˜ì‚¬ë²•',
                sound_devices: 'ğŸµ ìŒì„± ê¸°ë²•',
                themes_symbols: 'ğŸ”® ì£¼ì œì™€ ìƒì§•',
                style_tone: 'âœï¸ ë¬¸ì²´ì™€ ì–´ì¡°',
                structure_form: 'ğŸ—ï¸ êµ¬ì¡°ì™€ í˜•ì‹'
            };
            
            for (const [key, items] of Object.entries(analysis)) {
                if (items.length > 0) {
                    previewHtml += `<h4>${categoryNames[key]} (${items.length}ê°œ)</h4>`;
                    items.slice(0, 3).forEach(item => {
                        previewHtml += `<p><strong>${item.type}:</strong> ${item.text}</p>`;
                        if (item.explanation && item.explanation !== item.text) {
                            previewHtml += `<p style="margin-left: 20px; color: #666;"><em>${item.explanation}</em></p>`;
                        }
                    });
                    if (items.length > 3) {
                        previewHtml += `<p><em>... ì™¸ ${items.length - 3}ê°œ ë”</em></p>`;
                    }
                    previewHtml += '<br>';
                }
            }
            
            document.getElementById('previewContent').innerHTML = previewHtml;
            document.getElementById('results').style.display = 'block';
        }
        
        function generateHTMLReport(result) {
            const analysis = result.analysis;
            const poemText = document.getElementById('poemInput').value;
            
            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${result.title} - ì‹œ ë¶„ì„ ë³´ê³ ì„œ</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .poem-text {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            margin: 30px 0;
            font-style: italic;
            white-space: pre-line;
        }
        .analysis-section {
            margin: 40px 0;
        }
        .section-title {
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        .analysis-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .item-type {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        .item-text {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }
        .item-explanation {
            color: #6c757d;
            font-style: italic;
        }
        .summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-top: 40px;
        }
        .summary h2 {
            margin-bottom: 15px;
        }
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            color: #6c757d;
            font-size: 0.9em;
        }
        @media print {
            body { font-size: 12pt; }
            .header { page-break-after: avoid; }
            .analysis-item { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“š ì‹œ ë¶„ì„ ë³´ê³ ì„œ</h1>
        <h2>${result.title}</h2>
        <p>ìƒì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
    </div>
    
    <div class="poem-text">
        <h3>ğŸ“œ ì›ë¬¸</h3>
        ${poemText}
    </div>
    
    ${Object.entries(analysis).map(([key, items]) => {
        if (items.length === 0) return '';
        
        const categoryNames = {
            rhetorical_devices: 'ğŸ­ ìˆ˜ì‚¬ë²• ë¶„ì„',
            sound_devices: 'ğŸµ ìŒì„± ê¸°ë²• ë¶„ì„',
            themes_symbols: 'ğŸ”® ì£¼ì œì™€ ìƒì§• ë¶„ì„',
            style_tone: 'âœï¸ ë¬¸ì²´ì™€ ì–´ì¡° ë¶„ì„',
            structure_form: 'ğŸ—ï¸ êµ¬ì¡°ì™€ í˜•ì‹ ë¶„ì„'
        };
        
        return `
        <div class="analysis-section">
            <h2 class="section-title">${categoryNames[key]}</h2>
            ${items.map(item => `
                <div class="analysis-item">
                    <div class="item-type">${item.type}</div>
                    <div class="item-text">"${item.text}"</div>
                    <div class="item-explanation">${item.explanation}</div>
                </div>
            `).join('')}
        </div>
        `;
    }).join('')}
    
    <div class="summary">
        <h2>ğŸ“Š ì¢…í•© ë¶„ì„</h2>
        <p>${result.summary}</p>
    </div>
    
    <div class="footer">
        <p>ğŸ¤– AI ê¸°ë°˜ ì‹œ ë¶„ì„ ë„êµ¬ë¡œ ìƒì„±ë¨</p>
        <p>ğŸ“š Poetry Analyzer - Powered by Google Gemini AI</p>
    </div>
</body>
</html>`;
        }
        
        function downloadReport() {
            if (!currentAnalysisResult) {
                showError('ë‹¤ìš´ë¡œë“œí•  ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const htmlContent = generateHTMLReport(currentAnalysisResult);
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `${currentAnalysisResult.title.replace(/[^a-zA-Z0-9ê°€-í£\s]/g, '_')}_ë¶„ì„ë³´ê³ ì„œ.html`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>